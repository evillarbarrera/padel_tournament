<%= form_with(model: @campeonato, local: true) do |form| %>
  <ul class="nav nav-tabs mb-4" id="campeonatoTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active text-white bg-primary" id="datos-basicos-tab" data-bs-toggle="tab" data-bs-target="#datos-basicos" type="button" role="tab">
        Datos Básicos
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link text-white bg-success" id="tipo-inscripcion-tab" data-bs-toggle="tab" data-bs-target="#tipo-inscripcion" type="button" role="tab">
        Tipos de Inscripción
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link text-white bg-info" id="categorias-tab" data-bs-toggle="tab" data-bs-target="#categorias" type="button" role="tab">
        Categorías
      </button>
    </li>
  </ul>

  <div class="tab-content" id="campeonatoTabsContent">
    <!-- Datos Básicos -->
    <div class="tab-pane fade show active" id="datos-basicos" role="tabpanel">
      <!-- Aquí van los campos básicos igual que antes... -->
      <div class="mb-3">
        <%= form.label :nombre, "Nombre del Campeonato" %>
        <%= form.text_field :nombre, class: "form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :descripcion, "Descripción" %>
        <%= form.text_area :descripcion, class: "form-control", rows: 3 %>
      </div>
      <div class="mb-3">
        <%= form.label :foto, "Foto URL" %>
        <%= form.text_field :foto, class: "form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :normativo, "Normativo" %>
        <%= form.text_area :normativo, class: "form-control", rows: 3 %>
      </div>
      <div class="mb-3">
        <%= form.label :tipo, "Tipo" %>
        <%= form.text_field :tipo, class: "form-control" %>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= form.label :fecha_inicio, "Fecha de Inicio" %>
          <%= form.date_field :fecha_inicio, class: "form-control" %>
        </div>
        <div class="col-md-6 mb-3">
          <%= form.label :fecha_termino, "Fecha de Término" %>
          <%= form.date_field :fecha_termino, class: "form-control" %>
        </div>
      </div>
      <div class="mb-3">
        <%= form.label :cupos_maximos, "Cupos Máximos" %>
        <%= form.number_field :cupos_maximos, class: "form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :estado, "Estado" %>
        <%= form.text_field :estado, class: "form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :reglas, "Reglas" %>
        <%= form.text_area :reglas, class: "form-control", rows: 3 %>
      </div>
    </div>

    <!-- Tipos de Inscripción -->
    <div class="tab-pane fade" id="tipo-inscripcion" role="tabpanel">
      <h5 class="mb-3">Tipos de Inscripción (hasta 4)</h5>
      <div id="tipos-inscripcion-container">
        <!-- El primer tipo de inscripción (por defecto) -->
        <div class="border rounded p-3 mb-3 tipo-inscripcion-item">
          <h6>Tipo de Inscripción 1</h6>
          <div class="mb-2">
            <%= form.label :nombre, "Nombre", for: "tipo_inscripcion_0_nombre" %>
            <%= text_field_tag "campeonato[tipo_inscripcions_attributes][0][nombre]", nil, class: "form-control", id: "tipo_inscripcion_0_nombre" %>
          </div>
          <div class="mb-2">
            <%= form.label :monto, "Monto", for: "tipo_inscripcion_0_monto" %>
            <%= number_field_tag "campeonato[tipo_inscripcions_attributes][0][monto]", nil, class: "form-control", id: "tipo_inscripcion_0_monto" %>
          </div>
          <div class="mb-2">
            <%= form.label :fecha_limite_pago, "Fecha Límite de Pago", for: "tipo_inscripcion_0_fecha_limite_pago" %>
            <%= date_field_tag "campeonato[tipo_inscripcions_attributes][0][fecha_limite_pago]", nil, class: "form-control", id: "tipo_inscripcion_0_fecha_limite_pago" %>
          </div>
          <div class="mb-2">
            <%= form.label :beneficios, "Beneficios", for: "tipo_inscripcion_0_beneficios" %>
            <%= text_area_tag "campeonato[tipo_inscripcions_attributes][0][beneficios]", nil, class: "form-control", rows: 2, id: "tipo_inscripcion_0_beneficios" %>
          </div>
        </div>
      </div>

      <button type="button" id="agregar-tipo-btn" class="btn btn-outline-primary">+ Agregar tipo</button>
    </div>

    <!-- Categorías -->
    <div class="tab-pane fade" id="categorias" role="tabpanel">
      <h5 class="mb-3">Selecciona Categorías para el Campeonato</h5>
      <div class="row" style="max-height: 350px; overflow-y: auto;">
        <div class="col-md-6">
          <h6 class="text-primary">Categorías Masculinas</h6>
          <% categorias_masculinas = [
            "6ta Categoría (Nivel E): Principiante",
            "5ta Categoría (Nivel D Baja)",
            "4ta Categoría (Nivel D Alta)",
            "3ra Categoría (Nivel C)",
            "2da Categoría (Nivel B)",
            "1ra Categoría (Nivel A)",
            "+35 Seniors",
            "+40 Seniors",
            "+45 Seniors",
            "+50 Seniors",
            "+55 Seniors"
          ] %>

          <% categorias_masculinas.each_with_index do |categoria, i| %>
            <div class="form-check">
              <%= check_box_tag "campeonato[categorias_seleccionadas][]", categoria, false, id: "categoria_m_#{i}", class: "form-check-input" %>
              <%= label_tag "categoria_m_#{i}", categoria, class: "form-check-label" %>
            </div>
          <% end %>
        </div>

        <div class="col-md-6">
          <h6 class="text-danger">Categorías Femeninas</h6>
          <% categorias_femeninas = [
            "Categoría D (Femenina)",
            "Categoría C (Femenina)",
            "Categoría B (Femenina)",
            "Categoría A (Femenina)",
            "+30 Seniors (Femenina)",
            "+35 Seniors (Femenina)",
            "+40 Seniors (Femenina)",
            "+45 Seniors (Femenina)",
            "+50 Seniors (Femenina)",
            "+55 Seniors (Femenina)"
          ] %>

          <% categorias_femeninas.each_with_index do |categoria, i| %>
            <div class="form-check">
              <%= check_box_tag "campeonato[categorias_seleccionadas][]", categoria, false, id: "categoria_f_#{i}", class: "form-check-input" %>
              <%= label_tag "categoria_f_#{i}", categoria, class: "form-check-label" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <%= form.submit "Guardar Campeonato", class: "btn btn-primary" %>
  </div>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const maxTipos = 4;
    let tipoCount = 1;
    const container = document.getElementById('tipos-inscripcion-container');
    const btnAgregar = document.getElementById('agregar-tipo-btn');

    btnAgregar.addEventListener('click', () => {
      if (tipoCount >= maxTipos) {
        alert("Solo puedes agregar hasta 4 tipos de inscripción.");
        return;
      }
      tipoCount++;

      // Crear nuevo bloque tipo inscripción
      const nuevoDiv = document.createElement('div');
      nuevoDiv.classList.add('border', 'rounded', 'p-3', 'mb-3', 'tipo-inscripcion-item');
      nuevoDiv.innerHTML = `
        <h6>Tipo de Inscripción ${tipoCount}</h6>
        <div class="mb-2">
          <label for="tipo_inscripcion_${tipoCount - 1}_nombre">Nombre</label>
          <input type="text" name="campeonato[tipo_inscripcions_attributes][${tipoCount - 1}][nombre]" id="tipo_inscripcion_${tipoCount - 1}_nombre" class="form-control">
        </div>
        <div class="mb-2">
          <label for="tipo_inscripcion_${tipoCount - 1}_monto">Monto</label>
          <input type="number" name="campeonato[tipo_inscripcions_attributes][${tipoCount - 1}][monto]" id="tipo_inscripcion_${tipoCount - 1}_monto" class="form-control">
        </div>
        <div class="mb-2">
          <label for="tipo_inscripcion_${tipoCount - 1}_fecha_limite_pago">Fecha Límite de Pago</label>
          <input type="date" name="campeonato[tipo_inscripcions_attributes][${tipoCount - 1}][fecha_limite_pago]" id="tipo_inscripcion_${tipoCount - 1}_fecha_limite_pago" class="form-control">
        </div>
        <div class="mb-2">
          <label for="tipo_inscripcion_${tipoCount - 1}_beneficios">Beneficios</label>
          <textarea name="campeonato[tipo_inscripcions_attributes][${tipoCount - 1}][beneficios]" id="tipo_inscripcion_${tipoCount - 1}_beneficios" rows="2" class="form-control"></textarea>
        </div>
      `;
      container.appendChild(nuevoDiv);
    });
  });
</script>
